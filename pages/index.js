import Head from "next/head";
import Link from "next/link";
import Image from "next/image";
import { useState } from "react";

import { MaskProvider, Mask } from "../components/Mask";
import Content from "../components/Content";
import { getProjects } from "../lib/projects";
import styles from "../styles/Home.module.scss";

export async function getStaticProps() {
  let projects = await getProjects();
  return {
    props: {
      projects: projects.map(({ data }) => data),
    },
  };
}

const isChrome =
  process.browser &&
  /Chrome/.test(navigator.userAgent) &&
  /Google Inc/.test(navigator.vendor);

function Project({ id, cover, hover, title }) {
  return (
    <Mask>
      {(url) => {
        const maskImage = isChrome ? "WebkitMaskImage" : "maskImage";
        const style = {};
        style[maskImage] = `url(${url})`;

        return (
          <Link key={id} href={`/projects/${id}`}>
            <a className="column is-half-desktop" style={style}>
              <Content hover={hover} aspectX={2500} aspectY={1441}>
                <Image
                  alt={title}
                  src={cover}
                  layout="fill"
                  objectFit="cover"
                />
              </Content>
            </a>
          </Link>
        );
      }}
    </Mask>
  );
}

export default function Home({ projects }) {
  const thumbnails = projects.map((props) => (
    <Project {...props} key={props.id} />
  ));

  return (
    <div className={`${styles.home} columns is-desktop is-multiline`}>
      <Head>
        <title>laragabathuler</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <MaskProvider>{thumbnails}</MaskProvider>
    </div>
  );
}
